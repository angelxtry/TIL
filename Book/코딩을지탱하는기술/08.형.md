# 8장. 형

- 형은 사람이 데이터에 붙인 추가 데이터다.
- 같은 비트열이라도 그것을 어떤 종류의 값으로 해석할지에 따라 틀린 값이 되어버린다.
- 이를 피하기 위해 어떤 종류의 값인가라는 정보를 추가한 것이 형의 시작이다.

## 수치를 On과 Off로 표현하는 방법

- 0부터 999까지 표현하기 위해 100의 자리 9개, 10의 자리 9개 1의 자리 9개의 27개 램프만 있으면 충분하다.
- 전부 꺼져있으면 0, 모두 켜져있으면 9
- 자릿수를 사용함으로써 999개에서 27개로 램프수를 줄일 수 있다.

- 7 세그먼트 디스플레이를 사용하면 7개의 램프로 한 자릿수를 표현할 수 있어서 3자리수를 표현하기 위해 필요한 램프 개수를 21개가 된다.

- 주판의 표현 방법을 사용하면 5개 램프로 한 자릿수를 표현할 수 있다.
- 3자릿수를 표현하려면 15개의 램프가 필요하다.

- 2진수를 사용하면 10개의 램프로 0부터 1023까지 표현할 수 있다.

- 실제 컴퓨터는 정수를 표현하기 위해 몇 개 램프를 사용할까?
- 1983년에 닌텐도가 출시한 패밀리 컴퓨터에서는 8개의 램프를 사용했다.
- 제대로 표현하자면 8비트 CPU가 사용됐다.
- 정수형으로 표현할 수 있는 범위는 0 ~ 255
- 현재 컴퓨터는 32개나 64개의 램프를 사용하는 방식이 주류다.

## 고정 소수점

- 소수점을 어디에 붙일지 정한다.

## 부동 소수점

- 어디부터 소수부인지 정보 자체를 값에 포함시킨다.

- 좌측 끝 램프(최상위 비트)는 수의 부호를 표현한다.
- 즉, 이 비트가 0이면 양의 값, 1으면 음의 값이다.

## 형은 무엇을 위해 존재할까

- 이 변수는 장수다라고 컴퓨터에게 기억하게 하는 것
- `int x;`라고 선언하면 이 메모리 영역은 정수로 해석한다.
- `float x;`라고 선언하면 이 메모리 영역은 부동 소수점으로 해석한다.
- 형 정보가 주어짐으로 컴퓨터는 덧셈을 할 때 정수를 덧셈할지 부동 소수점을 덧셈할지 판단할 수 있게 된다.

- 언어마다 다르지만 암묵적 형 변환이 발생한다.
- 프로그래머는 x가 어떤 형인지 기억해두지 않으면 x/2라는 코드를 보고도 소수점 이하를 버리는지 아닌지를 알 수 없다.
- 사람이 형을 기억해야 한다는 제약은 형이 존재하는 이유에 역행하는 것이다.

- Python x/y는 형과 상관없이 소수점 이하를 버리지 않는 나눗셈
- x // y는 소수점 이하를 버리는 나눗셈으로 표현한다.

## 형의 다양한 전개

### 사용자 정의형과 객체 지향

- 언어가 가지고 있는 기본적인 형을 조합해서 새로운 형을 만드는 기능이 발명됐다.
- C언어의 구조체
- 정수 같은 데이터뿐만 아니라 함수 등 데이터를 처리하는 기능도 형으로 정리되었다.
- C++ 설계자는 사용자가 정의할 수 있는 형이야 말로 프로그램을 구축하기 위한 기본적 요소라고 생각했으며, 이런 형에 클래스라는 이름을 붙였다.

### 사양 Specification 으로서 형

#### 공개와 비공개를 나누다

- 형은 사양이라는 개념이 등장한다.
- 구조체나 클래스를 구성하는 형을 전부 공개하지 않고 최소한만을 공개한다는 것이다.
- 형이 맞는지 틀린지는 컴파일러가 체크해주기 때문에 사양을 형으로 표현하면 사양과 일치하는지를 컴파일러가 체크해준다.
- 그래서 외부와 작업하는 부분만을 형으로 공개하고, 상세 구현은 숨긴다는 발상이다.
- 이렇게 해서 형에 공개 부분과 비공개 부분이 생기게 되었다.

#### 인터페이스로 발전

- 형은 사양이다라는 개념은 더욱 진화해서 구체적인 구현 방법을 가지고 있지 않은 형(Java의 인터페이스 등)이 탄생했다.
- 또한 함수가 예외를 던질지 말지의 정보도 형에 포함하는 언어가 등장했다.

### 총칭형, 제네릭, 템플릿

- 다양한 형을 조합해서 만든 복잡한 형이 사용되면서 일부만을 바꾸고 싶은데 전부 다시 정의해야 하는 것은 이상하니 재사용하고 싶다는 필요가 생겨났다.
- 구성 요소의 형을 일부만 바꾸는 형, 다르게 설명하면 형이 인수를 가지고 형을 만드는 함수가 생겼다.
- C++의 템플릿, Java의제네렉, Haskell의 형 생성자 등이 그런 구조다.

### 동적 형결정

- 형 구조에서는 변수명, 값이 저장된 메모리의 위치, 해당 메모리의 내용은 어떤 종류의 값인가를 한 세트로 가지고 있다.
- 이런 종류 정보를 값과 함께 세트로 가지고 있는 것을 동적 형결정이라 한다.
- 대부분의 스크립트 언어가 동적 형결정을 채용하고 있다.

- 동적 형결정 언어에서 형 선언이 필요 없는 것은 메모리 상에서 동일한 형으로 취급되도록 설계되어 있기 때문이다.
- Python에서 값은 정수든 부동 소수점이든 문자열이든 모두 PyObject 형으로 취급되도록 머리 부분이 모두 같은 형태로 되어 있다.
- PyObject 형의 구조 안에는 값의 종류 정보를 저장할 수 있는 공간이 있다.
- 사용 횟수도 관리되는데 이것은 메모리 관리에 사용되는 값이 몇 군데서 참조되고 있는가를 의미한다.(참조 카운터)

### 형 추론

- 컴파일 시에 형 체크는 하지만 귀찮은 형 선언은 하고 싶지 않다.
- 이를 달성하기 위해 컴퓨터가 형을 추론하게 하는 접근이 있다.

----

## 칼럼. 대락적인 부분을 잡아서 조금씩 상세화한다

- 방대한 정보 앞에서 좌정하고 있을 때
- 책이나 문서의 목차를 보고 전체 구조를 대략적으로 파악한다.
- 그리고 나서 본문을 속독으로 읽어나간다.
- 자세히 보지 않고 우선은 소제목이나 강조 부분, 그림과 그림 제목 등을 본다.

- 소스 코드를 읽을 때는 우선 디렉터리 구조와 파일명을 본다.
- 그리고 파일을 속독으로 읽고 거기서 정의하고 있는 함수나 클래스 이름, 자주 호출되는 함수명 등을 본다.

- 우선 대략적인 구조를 잡고, 조금씩 상세한 정보로 접근한다.

- 소스 코드는 디버깅 과정과 유사하게 실행되는 순서나 호출 계층으로 읽는 방법도 있다.
- 이 경우도 동일하게 우선은 대략적인 처리 흐름을 따라가고, 조금씩 깊이를 더해서 함수 안의 처리를 따라가는 것이 좋다.
