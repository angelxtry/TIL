# django admin

staff, superuser 계정만 접근 가능

모델 클래스만 등록하면 조회/추가/수정/삭제 웹 인터페이스를 제공

admin 페이지에 접속해보면 user 항목이 있고 그 하위에 계정의 정보가 있다.

한 계정을 클릭해보면 하단에 Permissions -> Active/Staff status/Superuser status가 있다.

----

특정 app의 모델을 등록하기 위해서는 app/admin.py 파일을 수정한다.

```py
from django.contrib import admin
from .models import Post

admin.site.register(Post)
```

Post 모델을 등록할 때 커스터마이징해보자.

```py
from django.contrib import admin
from .models import Post

class PostAdmin(admin.ModelAdmin):
    pass

admin.site.register(Post, PostAdmin)
```

이렇게 하면 단순히 `admin.site.register(Post`를 한 것과 동일하다.

```py
from django.contrib import admin
from .models import Post

class PostAdmin(admin.ModelAdmin):
    list_display = ['id', 'title', 'content',]


admin.site.register(Post, PostAdmin)
```

이렇게 하면 admin -> Post 페이지에 id, title, content가 출력된다.


```py
from django.contrib import admin
from .models import Post


@admin.register(Post)
class PostAdmin(admin.Modeladmin):
    list_display = ['id', 'titile', 'content', ]
```

위와 같이 데코레이터를 사용해도 동일한 결과가 된다.

----

list_display 옵션

모델 인스턴스 필드명/속성명/함수명 뿐만 아니라 ModelAdmin 내의 멤버 함수도 지정가능하다.

외래키를 지정한다면 관련 object의 __str__() 값이 노출된다.

ManyToManyField는 지원하지 않는다.

```py
from django.contrib import admin
from .models import Post


@admin.register(Post)
class PostAdmin(admin.ModelAdmin):
    list_display = ['id', 'title', 'content', 'content_size',]

    def content_size(self, post):
        return '{}글자'.format(len(post.content))
    content_size.short_description = '글자수'
```

content_size 라는 함수를 생성하여 그 리턴값을 출력했다.

content_size.short_description을 이용하여 컬럼명을 변경할 수도 있다.

```py
from django.contrib import admin
from django.utils.safestring import mark_safe
from .models import Post


@admin.register(Post)
class PostAdmin(admin.ModelAdmin):
    list_display = ['id', 'title', 'content', 'content_size',]

    def content_size(self, post):
        return mark_safe('<strong>{}</strong>글자'.format(len(post.content)))
    content_size.short_discription = '글자수'
```

위와 같이 content_size 함수에서 리턴되는 문자열에 태그를 이용하여 꾸밀 수 있다.

이때 mark_safe라는 함수를 사용해야 한다.

----

Tag Escape

django는 파이썬 코드/변수를 통해 보여지는 Html Tag에 대해 Auto Escape를 수행한다.

a/image/script 태그 등의 의도하지 않은 또는 허용하지 않는 코드의 실행을 방지해준다.

특정 문자열에 한해 이를 해제하기 위해 format_html(), format_html_join(), mark_safe()를 적용할 수 있다.

