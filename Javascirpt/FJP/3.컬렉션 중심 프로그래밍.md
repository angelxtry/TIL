# 3. 컬렉션 중심 프로그래밍

## 컬렉션

> 앞서 다음의 열거 가능한 값을 컬렉션이라고 정의했습니다.

1. JSON 데이터 타입 내의 Object
2. Array, Map, Set ...
3. 그 외 `[Symbol.iterator]()`가 구현된 모든 iterable과 iterator
4. generator를 실행한 결과 값

## 3개의 대표 함수 map, reduce, findVal

- `map, reduce, findVal`을 이용하면 컬렉션을 다루는 거의 대부분의 로직을 구현할 수 있습니다.

### 함수 계층

- map
  - mapC, series
  - none, every

- reduce
  - pipe, groupBy, filter
  - go, partition, reject

- findVal
  - find, or, and
  - match, some

## reduce

- array가 아닌 모든 유사배열에는 reduce가 없다.
- 다른 함수형 스타일은 reduce(f, acc, coll)
- 자바스크립트는 reduce(f, coll, acc)가 더 나은듯

```js
function reduce(f, coll, acc) {

}

console.log(
  reduce((acc, a) => acc + a, [1, 2, 3])
);
```

- reduce는 위와 같이 생겼다.

```js
function reduce(f, coll, acc) {
  for (const v of coll) {

  }
  return acc;
}

console.log(
  reduce((acc, a) => acc + a, [1, 2, 3])
);
```

- reduce는 coll을 순회하여 acc를 return 할 것이다.

```js
function reduce(f, coll, acc) {
  for (const v of coll) {
    acc = f(acc, v);
  }
  return acc;
}

console.log(
  reduce((acc, a) => acc + a, [1, 2, 3], 0)
);
```

- acc가 존재하는 것이 더 구현하기 쉬우므로 0을 대입한다.
- 위와같이 구현하면 일단 성공.
- 이 reduce는 `[Symbol.iterator]`가 구현된 유사배열도 지원한다.

```js
reduce((acc, a) => acc + a, new Set([1, 2, 3]), 0)
```

- 배열이 아닌 Set을 대입해도 동작한다.
- Set도 `[Symbol.iterator]`가 구현되어 있고 이것은 for...of에 잘 동작한다.

- acc가 없을 경우 다음과 동일한 동작을 한다고 생각할 수 있다.

```js
reduce((acc, a) => acc + a, [2, 3], 1);
```

- 그러므로 reduce 함수 내에서 coll을 분해하여 처리할 수 있다.
- 과거에는 다음과 같은 방식으로 처리했을 것이다.

```js
acc = acc === undefined ? coll[0] : acc;
```

- 하지만 ES6+에는 더 효율적인 방법이 있다.

```js
function reduce(f, coll, acc) {
  const iter = coll[Symbol.iterator]();
  for (const v of iter) {
    acc = f(acc, v);
  }
  return acc;
}

console.log(
  reduce((acc, a) => acc + a, new Set([1, 2, 3]), 0)
);
```

- coll을 iterator로 만들었다.
- 이제부터 coll이 유사배열이라도 처리가능하다.

- 이제 acc가 없을 경우를 처리할 수 있다.

```js
function reduce(f, coll, acc) {
  const iter = coll[Symbol.iterator]();
  acc = acc === undefined ? iter.next().value : acc;
  for (const v of iter) {
    acc = f(acc, v);
  }
  return acc;
}

console.log(
  reduce((acc, a) => acc + a, new Set([1, 2, 3]))
);
```

- acc는 삼항 연산자를 이용했다.
