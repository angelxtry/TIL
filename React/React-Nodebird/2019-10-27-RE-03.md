# react-nodebird 3

ì œë¡œì´ˆë‹˜ì˜ ì¸í”„ëŸ° ê°•ì˜ë¥¼ ë³´ê³  ë”°ë¼í•œ ê²ƒì„ì„ ë¯¸ë¦¬ ë°íŒë‹¤.

## redux intro

reduxë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ packageë¥¼ ì„¤ì¹˜í•œë‹¤.

```js
> npm i redux react-redux next-redux-wrapper
```

`reducers`ë¼ëŠ” í´ë”ë¥¼ ë§Œë“¤ê³  í•´ë‹¹ í´ë”ì— ë‹¤ìŒê³¼ ê°™ì€ íŒŒì¼ì„ ìƒì„±í•œë‹¤.k

```js
> mkdir reducers

index.js
post.js
user.js
```

`user.js` ë¶€íƒ€ ì‘ì„±í•´ë³´ì.

`reducers/user.js`

```js
const initialState = {
  isLoggedIn: false,
  user: null,
};

const dummyUser = {
  nickname: 'angelx',
  Post: [],
  Followings: [],
  Followers: []
};

const reducer = (state = initialState, action) => {
  switch (action.type) {
    default: {
      return state;
    }
  }
};

export default reducer;

```

ì´ˆê¸° ìƒíƒœì™€ ë”ë¯¸ ë°ì´í„° ê·¸ë¦¬ê³  `reducer`ë¥¼ ë§Œë“¤ì—ˆë‹¤.

ì—¬ê¸°ì— ìƒíƒœë¥¼ ë³€ê²½í•˜ê¸° ìœ„í•œ ì½”ë“œë“¤ì´ ì¶”ê°€ë  ê²ƒì´ë‹¤.

`post.js`ë„ ë¹„ìŠ·í•˜ê²Œ ì‘ì„±í•œë‹¤.

`reducers/post.js`

```js
const initialState = {
  mainPosts: [
    {
      postId: 1,
      User: {
        id: 1,
        nickname: 'angelx'
      },
      content: 'Study hard more!',
      img: ''
    }
  ]
};

const dummyPost = {
    postId: 2,
    User: {
      id: 1,
      nickname: 'angelx'
    },
    content: 'Make money more',
    img: ''
};

const reducer = (state = initialState, action) => {
  switch (action.type) {
    default: {
      return state;
    }
  }
};

export default reducer;

```

`user.js`, `post.js`ì˜ reducerë¥¼ í†µí•©í•˜ì—¬ ê´€ë¦¬í•˜ê¸° ìœ„í•´ `index.js`ë¥¼ ì‘ì„±í•œë‹¤.

`reducers/index.js`

```js
import { combineReducers } from 'redux';
import user from './user';
import post from './post';

const rootReducer = combineReducers({
  user,
  post
});

export default rootReducer;

```

ë§ˆì§€ë§‰ìœ¼ë¡œ `rootReducer`ë¥¼ `Next.js`ì— ì—°ê²°í•˜ê¸° ìœ„í•´ `pages/_app.js` íŒŒì¼ì„ ìˆ˜ì •í•œë‹¤.

`pages/_app.js`

```js
import React from 'react';
import Head from 'next/head';
import PropTypes from 'prop-types';
import { applyMiddleware, compose, createStore } from 'redux';
import { Provider } from 'react-redux';
import withRedux from 'next-redux-wrapper';

import rootReducer from '../reducers';
import Layout from '../components/Layout';

const CandC = ({ Component, store }) => {
  return (
    <Provider store={store}>
      <Head>
        <title>C And C</title>
        <link
          rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/antd/3.23.6/antd.min.css"
        />
      </Head>
      <Layout>
        <Component />
      </Layout>
    </Provider>
  );
};

CandC.propTypes = {
  Component: PropTypes.elementType
};

export default withRedux((initialState, options) => {
  const middlewares = [];
  const enhancer = compose(
    applyMiddleware(...middlewares),
    !options.isServer &&
      typeof window.__REDUX_DEVTOOLS_EXTENSION__ !== 'undefined'
      ? window.__REDUX_DEVTOOLS_EXTENSION__()
      : (f) => f
  );
  const store = createStore(rootReducer, initialState, enhancer);
  return store;
})(CandC);

```

## Layoutì— redux ì ìš©í•´ë³´ê¸°

`components/Layout.js` íŒŒì¼ì— ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¼ ë¡œê·¸ì¸ í¼ê³¼ ì‚¬ìš©ì í”„ë¡œí•„ì´ ì¶œë ¥ë˜ëŠ” ì½”ë“œê°€ ìˆë‹¤.

ì—¬ê¸°ì— reduxë¥¼ ì ìš©í•´ë³´ì.

```js
import React from 'react';
import Link from 'next/link';
import PropTypes from 'prop-types';
import { useSelector } from 'react-redux'
import { Menu, Input, Row, Col } from 'antd';

import LoginForm from './LoginForm';
import UserProfile from './UserProfile';

const dummy = {
  isLoggedIn: false
};

const Layout = ({ children }) => {
  const { isLoggedIn } = useSelector(state => state.user);
  return (
    <div>
      <Menu mode="horizontal">
        <Menu.Item key="home">
          <Link href="/index">
            <a>Home</a>
          </Link>
        </Menu.Item>
        <Menu.Item key="profile">
          <Link href="/profile">
            <a>Profile</a>
          </Link>
        </Menu.Item>
        <Menu.Item key="search">
          <Input.Search enterButton style={{ verticalAlign: 'middle' }} />
        </Menu.Item>
      </Menu>
      <Row gutter={10}>
        <Col xs={24} md={6}>
          {isLoggedIn ? <UserProfile /> : <LoginForm />}
        </Col>
        <Col xs={24} md={12}>
          {children}
        </Col>
        <Col xs={24} md={6}></Col>
      </Row>
    </div>
  );
};

Layout.propTypes = {
  children: PropTypes.node
};

export default Layout;

```

`react-redux`ì˜ `useSelector`ë¥¼ ì´ìš©í•˜ì—¬ reduxì˜ stateì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.

ê¸°ì¡´ì—ëŠ” `dummy`ì˜ `isLoggedIn` ë°ì´í„°ë¥¼ ì‚¬ìš©í–ˆì§€ë§Œ, ì´ë²ˆì—ëŠ” reduxì˜ stateì¸ `isLoggedIn`ì„ ì‚¬ìš©í•œë‹¤.

`reducers/user.js`ì— ìˆëŠ” `initialState`ì˜ `isLoggedIn` ê°’ì— ë”°ë¼ ë¡œê·¸ì¸, ë¡œê·¸ì•„ì›ƒì´ ê²°ì •ëœë‹¤.

`dummy`ëŠ” ì‚­ì œí•˜ì.

## UserProfileì— redux ì ìš©

`reducers/user.js`ì˜ `initialState`ë¥¼ ì ì ˆíˆ ìˆ˜ì •í•œë‹¤.

```js
const initialState = {
  isLoggedIn: true,
  user: {
    nickname: 'angelx',
    myCafes: [{}, {}],
    Post: [],
    Followings: [],
    Followers: []
  }
};

```

`conponents/UserProfile.js` íŒŒì¼ì„ ìˆ˜ì •í•´ë³´ì.

```js
import React from 'react';
import { useSelector } from 'react-redux';

import { Card, Avatar } from 'antd';

const UserProfile = () => {
  const { user } = useSelector(state => state.user);
  return (
    <Card
      actions={[
        <div key="my-cafe">
          My Cafe
          <br />
          {user.myCafes.length}
        </div>
      ]}
    >
      <Card.Meta
        avatar={<Avatar>{user.nickname[0]}</Avatar>}
        title={user.nickname}
      />
    </Card>
  );
};

export default UserProfile;

```

`useSelector`ë¥¼ ì´ìš©í•˜ì—¬ reduxì˜ stateì— ì ‘ê·¼í–ˆë‹¤.

`pages/index.js`ì˜ dummyë„ reduxë¥¼ ì´ìš©í•˜ì—¬ ì œê±°í•´ë³´ì.

## reduxë¥¼ ì‚¬ìš©í•˜ì—¬ Login, Logout êµ¬í˜„

reduxì˜ stateë¥¼ ì‚¬ìš©í•´ë´¤ìœ¼ë‹ˆ actionì„ ì‚¬ìš©í•´ë³´ì.

ì•„ì§ ì„œë²„ê°€ ì—†ìœ¼ë‹ˆ ë”ë¯¸ ë°ì´í„°ë¡œ êµ¬í˜„í•´ë³´ì.

ì¼ë‹¨ ë¡œê·¸ì¸, ë¡œê·¸ì•„ì›ƒì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ `reducers/user.js`ë¥¼ ìˆ˜ì •í•œë‹¤.

```js
export const LOG_IN_REQUEST = 'LOG_IN_REQUEST';
export const LOG_IN_SUCCESS = 'LOG_IN_SUCCESS';
export const LOG_IN_FAILURE = 'LOG_IN_FAILURE';
export const LOG_OUT = 'LOG_OUT';

const initialState = {
  isLoggedIn: false,
  user: null
};

const dummyUser = {
  nickname: 'dummy user',
  myCafes: [{}, {}],
  Post: [],
  Followings: [],
  Followers: []
};

const reducer = (state = initialState, action) => {
  switch (action.type) {
    case LOG_IN_REQUEST: {
      return {
        ...state,
        isLoggedIn: false,
        user: null
      };
    }
    case LOG_IN_SUCCESS: {
      return {
        ...state,
        isLoggedIn: true,
        user: dummyUser
      };
    }
    case LOG_IN_FAILURE: {
      return {
        ...state,
        isLoggedIn: false,
        user: null
      };
    }
    case LOG_OUT: {
      return {
        ...state,
        isLoggedIn: false,
        user: null
      };
    }
    default: {
      return state;
    }
  }
};

export default reducer;

```

`components/LoginForm.js`

```js
import React, { useCallback } from 'react';
import Link from 'next/link';
import { useDispatch } from 'react-redux';
import { Form, Input, Button } from 'antd';

import useInput from '../components/useInput';
import { LOG_IN_SUCCESS } from '../reducers/user';

const LoginForm = () => {
  const [email, onChangeEmail] = useInput('');
  const [password, onChangePassword] = useInput('');

  const dispatch = useDispatch();
  const onSubmit = useCallback(
    (e) => {
      e.preventDefault();
      dispatch({
        type: LOG_IN_SUCCESS
      });
      console.log({ email, password });
    },
    [email, password]
  );

  return (
    <Form onSubmit={onSubmit} style={{ padding: '10px' }}>
      <div>
        <label htmlFor="user-email">Email</label>
        <Input
          name="user-email"
          required
          value={email}
          onChange={onChangeEmail}
        />
      </div>
      <div>
        <label htmlFor="user-password">Password</label>
        <Input
          name="user-password"
          type="password"
          required
          value={password}
          onChange={onChangePassword}
        />
      </div>
      <div style={{ marginTop: '10px' }}>
        <Button type="primary" htmlType="submit" loading={false}>
          Login
        </Button>
        <Link href="/signup">
          <Button>Signup</Button>
        </Link>
      </div>
    </Form>
  );
};

export default LoginForm;

```

actionì„ reduxì— ì „ë‹¬í•˜ê¸° ìœ„í•´ `react-redux`ì˜ `useDispatch`ë¥¼ ì‚¬ìš©í•œë‹¤.

ì´ë©”ì¼ê³¼ ì•”í˜¸ë¥¼ ì…ë ¥í•˜ëŠ” í¼ì— ì ë‹¹í•œ ë°ì´í„°ë¥¼ ë„£ê³  `Login` ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ reducerì— ì •í•´ ë†“ì€ actionì— ë”°ë¼ ë™ì‘í•œë‹¤.

ì„œë²„ê°€ ìš´ì˜ ì¤‘ì´ë¼ë©´ `Login` ë²„íŠ¼ì„ í´ë¦­í–ˆì„ ë•Œ `LOG_IN_REQUEST` actionì„ ì „ë‹¬í•˜ê³ , ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì€ ê²°ê³¼ì— ë”°ë¼ `LOG_IN_SUCCESS`, `LOG_IN_FAILURE`ê°€ ê²°ì •ëœë‹¤.

ì•„ì§ ì„œë²„ê°€ ì—†ê¸° ë•Œë¬¸ì— `Login` ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ë°”ë¡œ `LOG_IN_SUCCESS`ê°€ ì „ë‹¬ëœë‹¤.

ë¡œê·¸ì•„ì›ƒì€ `components/UserProfile.js`ì— êµ¬í˜„í•œë‹¤.

```js
import React, { useCallback } from 'react';
import { useDispatch, useSelector } from 'react-redux';
import { Card, Avatar, Button } from 'antd';

import { LOG_OUT } from '../reducers/user';

const UserProfile = () => {
  const dispatch = useDispatch();
  const onLogout = useCallback(() => {
    dispatch({
      type: LOG_OUT
    })
  }, []);

  const { user } = useSelector((state) => state.user);

  return (
    <Card
      actions={[
        <div key="my-cafe">
          My Cafe
          <br />
          {user.myCafes.length}
        </div>
      ]}
    >
      <Card.Meta
        avatar={<Avatar>{user.nickname[0]}</Avatar>}
        title={user.nickname}
      />
      <Button onClick={onLogout}>Logout</Button>
    </Card>
  );
};

export default UserProfile;

```

ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ êµ¬í˜„í–ˆë‹¤.
