# react node bird (5-8 ~ )

## signup api

`routes/user.js`

```js
const express = require("express");
const bcrypt = require("bcrypt");
const { User } = require("../models");

const router = express.Router();

// POST /api/user 회원가입
router.post("/", async (req, res) => {
  try {
    const { userId, nickname, password } = req.body;
    const exUser = await User.findOne({ where: { userId } });
    if (exUser) {
      return res.status(403).send("Already used.");
    } else {
      const hashedPassword = await bcrypt.hash(password, 10);
      const newUser = await User.create({
        userId,
        nickname,
        password: hashedPassword
      });
      console.log(newUser);
      return res.status(200).json(newUser);
    }
  } catch (error) {
    console.error(error);
    // 에러 처리를 여기서
    return next(error);
  }
});

module.exports = router;

```

signup은 자주 했더니 이제 외워서 칠 수 있을 정도다.

에러코드를 기억해두자.

이미 존재하는 유저일 경우 403이다.

`index.js`

```js
const express = require('express');
const morgan = require('morgan');
const cors = require('cors');

const db = require('./models');
const userAPIRouter = require('./routes/user');
const postAPIRouter = require('./routes/post');
const postsAPIRouter = require('./routes/posts');

const app = express();
db.sequelize.sync();

app.use(morgan('dev'));
app.use(express.json());
app.use(express.urlencoded({ extended: true }));
app.use(cors());

app.use('/api/user', userAPIRouter);
app.use('/api/post', postAPIRouter);
app.use('/api/posts', postsAPIRouter);

app.listen(3065, () => {
  console.log(`http://localhost:3065`);
});

```

client와 server가 다를 경우 cors를 주의하자.

## 로그인을 위한 미들웨어

cookie-parser, express-session, dotenv를 사용했다.
