# 7장. 이름과 스코프

- 초기 프로그래밍 언어에서는 변수와 메모리의 대응표를 프로그램 전체에서 공유하고 있었다.
- 즉 변수명이 유효한 범위가 프로그램 전체다.
- 이런 변수는 전역 스코프다라고 표현한다. 혹은 전역 변수라고 부른다.

- 변수명이 중복되는 것을 방지하기 위해 다음과 같이 처리한다.
  - 긴 변수명을 사용한다.
  - 스코프를 이용한다.

## 스코프의 진화

- 스코프란 이름의 유효 범위다.

### 동적 스코프

- 해결 방법 중 하나는 함수 입구에 원래의 값을 기록해두고 출구에서 원래의 값으로 되돌리는 것.
- 이런 스코프를 동적 스코프라고 한다.
- 동적 스코프는 변수를 변경한 후 다른 함수를 호출한 경우 호출된 함수에 영향을 미친다.
- 즉 변경값이 호출되는 곳에 파급되기 때문에 변수값을 참조했을 때 어떤 값이 될지는 호출처의 코드를 보지 않고선 알 수 없다.

### 정적 스코프

- 함수가 호출될 때마다 새로운 대응표를 만든다.
- 같은 함수를 호출해도 호출별도 하나씩 대응표를 만든다.
- 함수 안에서의 변경은 함수 밖까지 영향을 주지 않는다.

- Python은 처음부터 정적 스코프였다.
- 2000년에 출시된 Python 2.0에서는 대응표(스코프)에 3가지 계층이 있었다.
- 범위가 넓은 것부터 순서대로 built-in, 전역, 지역 3가지다.
- 프로그램 전체를 위한 built-in, 파일 단위의 전역, 함수 단위의 지역으로 구분할 수 있다.

- Python은 대입과 함께 변수를 만드는 언어다.
- 함수 안에서 대입하면 아무것도 선언하지 않더라도 지역 변수가 된다.
- 이 설계에는 적어도 2가지 문제점이 존재한다.

- 내포 함수의 문제점
  - 내포 함수의 지역 스코프에서 변수를 찾지못하면 상위 함수에서 해당 변수를 찾는 것이 아니라 전역 스코프에서 변수를 찾는다.
  - 상위 함수에서 해당 변수를 찾도록 수정되었다.

- 외부 스코프에 재귀속되는 문제
  - 내포한 스코프의 외부 변수를 변경할 수 없는 문제
  - 아래 코드를 보면 foo 스코프의 변수 x의 값을 bar 스코프에서 변경했지만 결국 변경되지 않았다.
  - 즉, 내포 함수으 스코프에서는 외부 스코프에 있는 변수를 변경할 수 없다는 것을 의미한다.

```py
def foo():
    x = 'old'
    def bar():
        x = 'new'
    bar()
    print(x)

foo()
# old
```

- Python에서의 해결 방법
  - nonlocal

```py
def foo():
    x = 'old'
    def bar():
        nonlocal x  # 지역 변수가 아님을 선언
        x = 'new'
    bar()
    print(x)

foo()
# new
```

- 현재는 정적 스코프가 주로 사용되고 있다.
- 변수는 거의 모든 언어에서 사용하고 있어서 모든 언어에서 같다거나 옛날부터 바뀌지 않았다라고 착각하기 쉽다.
- 하지만 언어에 따라 다양한 차이가 있고, 개선을 위해서 다양한 논의가 이뤄지고 있다.

- 동적 스코프는 많이 사용되고 있지는 않지만 없어진 것은 아니다.
- 정적 스코프에서는 스코프가 소스 코드 상에 한 묶음의 영역으로 존재하지만, 동적 스코프에서는 스코프에 들어가서 나갈 때까지 시간축 상에 존재하는 범위다.
- 어떤 처리를 하고 있는 중간에 일시적으로 변수값을 바꾸고 나중에 되돌린다는 처리를 하고 있다면 동적 스코프를 만들고 있는 것과 같다.
- 예외 처리도 동적 스코프와 닯았다.
- 어떤 함수 내에서 예외를 던질 때의 처리가 호출처에 있는 함수의 try/catch로 인해 영향을 받는다.

- 객체 지향에서 private 선언 등의 접근 지시자도 접근 가능한 범위를 제한한다는 점에서 스코프와 닯았다.
- 접근 가능한 점위가 클래스 내로 제한되는 private에 비해 protected는 지식 클래스까지 범위가 넓어진다.
- 이것은 호출처에서 변경한 것이 호출한 곳에 영향을 끼치는 동적 스코프와 닮았다.
- 영향 범위가 코드 상의 한 곳에 모여지지 않는다는 단점이 있다.

- Java는 정적 스코프 언어이지만 클래스는 소스 코드 어디서든 참조할 수 있다.
- 즉, 클래스는 전역 스코프라고 할 수 있다.
- 클래스는 이름이 계층적으로 이루어져있고, 임포트하지 않으면 사용할 수 없어서 전역 변수가 가지고 있던 충돌 문제를 피하고 있다.
- 그러나 전역 변수도 클래스의 static 멤버도 소스 코드 어디서든지 바꿀 수 있다는 점에서는 같다.
- 편리하게 사용할 수 있지만, 남용하면 이해하기 어려운 코드가 되어버린다.

- 스코프는 이해하기 쉬운 코드를 만들기 위한 핵심 개념이다.
