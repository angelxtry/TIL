# Django Form

* Model 클래스와 유사하게 Form 클래스를 정의

* 주요 역할 : 커스텀 Form 클래스

    * 입력폼 HTML 생성 : .as_table(), .as_p(), .as_ul() 기본 제공

    * 입력폼 값 검증(validation) 및 값 변환

    * 검증을 통과한 값들을 사전타입으로 제공

```py
def post_new(request):
    if request.method == 'POST':
        form = PostForm(request.POST, request.FILES)
        if form.is_valid():
            post = Post(**self.cleaned_data)
            post.save()
            return redirect(post)
    else:
        form = PostForm()
    return render(request, 'blog/post_form.html', {
        'form': form,
    })
```

----

Django Style

* 폼 처리 시에 같은 URL(같은 뷰)에서 GET/POST로 나눠 처리

* GET방식으로 요청될 때 : 입력폼을 보여준다.

* POST방식으로 요청될 떄

    * 데이터를 입력받아 유효성 검증 과정을 거친다.

    * 검증 성공 시 : 해당 데이터를 저장하고 SUCCESS URL로 이동

    * 검증 실패 시 : 오류 메시지와 함께 임력폼을 다시 보여준다.

----

dojo/models.py

```py
# dojo/models.py
class Post(models.Model):
    title = models.CharField(max_length=100)
    content = models.TextField()
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeFiedl(auto_now=True)
```

migration 진행

----

dojo/forms.py

```py
# dojo/forms.py
from django import forms


def min_length_3_validator(value):
    if len(value) < 3:
        raise forms.ValidationError('3글자 이상 입력해주세요.')

class PostForm(forms.Form):
    title = forms.CharField(validators=[min_length_3_validator])
    content = forms.CharField(widget=forms.Textarea)

```

models.py 파일에서 TextField로 표현한 것을 forms.py 파일에서는 CharField로 표현했다.

models.py는 DB에 모델을 생성하기 위해 TextField를 사용했다.

하지만 forms.py에서는 DB의 제약이 필요없다. 그리고 widget을 만들때 길이제한 등을 고려할 필요가 없기 때문에 CharField를 사용한다.

단지 적절한 widget을 보여주기 위해 widget이라는 인자를 사용한다.

validator가 구현되어있지 않다면 Form은 해당 값이 유무만을 검사한다.

validator는 함수로 구현한다.

이 함수를 값을 리턴하는 것이 아니라 예외를 발생시킨다.

구현할 min_length_3_validator는 필드에 인자로 제공된다.

이때 함수 자체를 인자로 넘긴다.

----

dojo/urls.py

```py
...
url(r'^new/$', views.post_new),
...
```
 
dojo/views.py
```py
...
from .forms import PostForm
...
def post_new(request):
    if request.method == 'POST':
        form = PostForm(request.POST, request.FILES)
    else:
        form = PostForm()
    return render(request, 'dojo/post_form.html', {
        'form': form,
    })
...
```
