# Apollo Fullstack Tutorial

## Apollo Server ì„¤ì •

```js
const { ApolloServer } = require('apollo-server');
const typeDefs = require('./schema');

const server = new ApolloServer({ typeDefs });
```

ApolloServerë¥¼ importí•˜ê³  instanceë¥¼ ìƒì„±í•œë‹¤.

ì´ ë•Œ ApolloServerì— schemaë¥¼ ì¸ìë¡œ ì „ë‹¬í•œë‹¤.

## Schema

GraphQLì€ schemaê°€ ì¤‘ì‹¬ì´ê³ , ê·¼ê°„ì´ë‹¤.

schemaëŠ” ëª¨ë“  data typeê³¼ relationsë¥¼ ì„¤ëª…í•˜ëŠ” ì²­ì‚¬ì§„ì´ë‹¤.

ìš°ë¦¬ê°€ fetch í•  ìˆ˜ ìˆëŠ” dataì™€ mutationì„ í†µí•´ update í•  ìˆ˜ ìˆëŠ” dataë¥¼ ì •ì˜í•œë‹¤.

schemaëŠ” schemaë¥¼ ì‚¬ìš©í•˜ëŠ” clientì˜ í•„ìš”ì— ë§ê²Œ ìƒì„±ë˜ì–´ì•¼ í•œë‹¤.

schemaëŠ” frontì™€ backì˜ ì¤‘ê°„ì— ìœ„ì¹˜í•œë‹¤. ê·¸ë¦¬ê³  frontì™€ backì˜ í˜‘ë ¥ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ë‹¤. ê·¸ë˜ì„œ schema first developmentë¥¼ ì¶”ì²œí•œë‹¤.

```js
const { gql } = require('apollo-server');

const typeDefs = gql``;

module.exports = typeDefs;
```

apollo-serverì—ì„œ gqlì„ import í•œë‹¤.

gqlì€ backtickìœ¼ë¡œ ê°ì‹¼ ë¶€ë¶„ì— ì •ì˜í•œë‹¤.

## Query type

Query typeì€ dataë¥¼ fetch í•  ìˆ˜ ìˆë„ë¡ ì •ì˜í•œ schemaì˜ entry pointë‹¤.

```graphql
const { gql } = require('apollo-server');

const typeDefs = gql`
  type Query {
    launches: [Launch]!
    launch(id: ID!): Launch
    me: User
  }
`;

module.exports = typeDefs;
```

ì¶”ê°€ ì„¤ëª…ì€ ìƒëµí•œë‹¤.

## Object & scalar types

Launch, Userì™€ ê°™ì€ ê²ƒë“¤ì€ Object typeì´ë‹¤.

Object typeì€ gql ë‚´ì—ì„œ ì •ì˜í•´ì•¼ í•œë‹¤.

```graphql
type Launch {
  id: ID!
  site: String
  mission: Mission
  rocket: Rocket
  isBooked: Boolean!
}
```

ID, String, Booleanì€ scalar typeì´ë‹¤.

scalar typeì€ graphì—ì„œ leafë‹¤. ì¦‰, ëª¨ë“  ê°€ì§€ì˜ ê°€ì¥ ëì— í•´ë‹¹í•œë‹¤.

```graphql
type Rocket {
  id: ID!
  name: String
  type: String
}

type User {
  id: ID!
  email: String!
  trips: [Launch]!
}

type Mission {
  name: String
  missionPatch(size: PatchSize): String
}

enum PatchSize {
  SMALL
  LARGE
}
```

missionPatchëŠ” ì¸ìë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤. GraphQLì—ì„œ fieldëŠ” ì¸ìë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤. ê·¸ë˜ì„œ ë” ìœ ì—°í•˜ë‹¤.

PatchSizeëŠ” enum type ì´ë‹¤. enum typeì„ ì–´ë–»ê²Œ ì •ì˜í•˜ëŠ”ì§€ëŠ” ë’¤ì— ë‚˜ì˜¤ê² ì§€?

## Mutation type

```graphql
type Mutation {
  bookTrips(launchIds: [ID]!): TripUpdateResponse!
  cancelTrip(launchId: ID!): TripUpdateResponse!
  login(email: String): String
}
```

bookTripsë§Œ ë³´ë©´ ì¸ìë¥¼ ë°›ê³  ê²°ê³¼ë¥¼ returní•œë‹¤.

return í•˜ëŠ” dataì˜ typeì€ ì‚¬ìš©ì ì •ì˜ typeìœ¼ë¡œ í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•œë‹¤.

```graphql
type TripUpdateResponse {
  success: Boolean!
  message: String
  launches: [Launch]
}
```

user define responseë‹¤.

status(success), message, data(launches)ë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤.

Apollo clientì˜ cacheê°€ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ ë˜ë ¤ë©´ í•­ìƒ ì—…ë°ì´íŠ¸ ê²°ê³¼ë¥¼ return í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•œë‹¤.

## server start

```js
const { ApolloServer } = require('apollo-server');

const typeDefs = require('./schema');

const server = ApolloServer({ typeDefs });

server.listen().then(({ url }) => {
  console.log(`Server ready at ${url}`);
});

```

npm startë¥¼ í•˜ë©´ `http://localhost:4000`ì—ì„œ ë°”ë¡œ ì‹¤í–‰ëœë‹¤. urlì€ ì–´ë””ì„œ ì˜¨ê±°ì§€? ì‹ ê¸°í•˜ë„¤.

ì•„... ApolloServerì— ë¯¸ë¦¬ ì •ì˜ë˜ì–´ ìˆì—ˆë‚˜ë³´ë‹¤.

`datasources/launch.js`

```js
const { RESTDataSource } = require('apollo-datasource-rest');

class LaunchAPI extends RESTDataSource {
  constructor() {
    super();
    this.baseURL = 'https://api.spacexdata.com/v2/';
  }
}

module.exports = LaunchAPI;

```

RESTDataSourceëŠ” RESTì˜ responseë¥¼ in-memoryì— cacheí•œë‹¤. ì´ê²ƒì„ partial query cachingì´ë¼ê³  ë¶€ë¥¸ë‹¤.

ì¬ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê²ƒì´ ì¥ì ì´ë¼ê³ ? ì•„ì§ ì˜ ê°ì´ ì•ˆì˜¨ë‹¤.

