# 4

- TDD 5개월
- 경험, 실수 고민 등을 공유
- contents
  - 01 방법에 대한 이야기
  - 02 경험에 대한 이야기

- 테스트는 단위 테스트 unit test
- 테스트 프레임워크는 Jest

- 01 방법에 대한 이야기
  - TDD vs. Test Last
  - TDD는 항상 red에서 시작
  - Test Last는 Green에서 시작하는 경우가 많음
    - red에서 시작하는 경우도 이미 구현 코드가 있는 경우
  - 기존 코드에 테스트 추가하기
    - 이미 테스트하기 쉽게 만들어져 있는 코드로 시작한다.
      - ex: utility, helper
      - 순수 함수, 외부 의존성이 없는 함수
      - ex: YYYY.M.DD. 형식의 문자열을 'YYYYMMDD'형식의 문자열로 변환
    - 프로덕션 코드는 절대 수정하지 않고 테스트 함수를 만든다.
    - 단순한 테스트 코드만 생성해도 된다.
      - 기존 프로덕션 코드에 익숙해지는 것이 목적
    - 리펙토링을 한다.
      - 테스트 코드를 절대 수정하지 않는다.
    - 테스트가 조금 익숙해졌다면 테스트 하기 어렵게 만들어져 있는 코드에서 테스트 하기 쉬운 것만 분리한다.
      - 선택 기준
        - 중요도가 높은 비지니스 로직이 포함된 부분
        - 버그가 발견된 부분
        - 결합이 낮고 논리는 복잡한 부분
    - 전반적인 흐름은
      - 테스트 가능한 코드를 찾아서
      - 분리
      - 테스트 코드를 추가하고
      - 리펙토링
    - 테스트 하기 어려운 부분
      - API 요청
      - 응답 결과에 따라 다른 UI
    - 프레임워크에 종속적인 부분을 입력값으로 변경한다.
    - 반환값을 스펙으로 추가한다?
  - 새로운 코드는 TDD로 개발한다.
    - 비지니스 요구사항이 추가되었을 때

- 02 경험에 대한 이야기
  - 좋은 점
    - 불안 감소
    - 스펙 문서 기능
      - 파라미터가 뭐가 있는지, 반환값을 어떤 모양인지
    - 디자인 개선 효과
    - 학습 동기 부여
      - 내가 얼마나 디자인을 못하는지 알게 된다.
      - 안정성과 설계에 관심을 갖게 된다.
    - 개발 생산성 향상
      - 버그 추적 시간이 줄어든다.
        - 브라우저를 열어서 확인하지 않아도 되는 코드들이 많아졌다.
      - 테스트 안 해서 아낀 시간 < 테스트 안 해서 나온 버그 고치는 시간
    - 프로젝트 생산성 향상
      - 비지니스 로직의 허점을 사전에 발견하게 된다.
      - 사전이란 본격적으로 코딩을 시작하기 전에
    - 집중력 향상
      - TDD는 동시에 한 가지 이상의 일을 하지 않도록 통제해준다.
  - 실수
    - 테스트 대상 오류
      - 테스트 자체가 목적이 되어버린다.
      - 무작정 커버리지를 높인다.
      - 무엇을 테스트 해야 하는지 잘 모를 때
      - 불필요하다는 의미
        - 비지니스와 관련된 버그를 낼 가능성이 낮거나 없고
        - 테스트를 유지함으로써 얻는 이익 < 테스트 유지와 관리에 드는 비용
        - 테스트가 단언하고 있는 내용이 사용자에 중요한 가치를 주는 것이 아닐 때
    - 필요하지만 검증 방식이 잘못된 테스트
      - DOM 구조는 변경될 가능성이 높아 깨지기 슆다.
      - 사용자에게 주는 가치가 상대적으로 낮다.
      - 테스트 유지 비용이 높은 반면 테스트로 얻을 수 있는 가치가 낮다.
      - 데이터에도 로직에도 문제가 없는 경우
    - 개선
      - 특정 위치를 가지고 뎅터가 있...
    - 검증력이 떨어지는 테스트
    - 테스트 제목과 검증의 불일치
    - 테스트를 앞서가는 프로덕션 코드
      - 테스트가 성공할 만큼의 최소한의 코드만 작성해야 한다.
      - 테스트가 성공하는 것 이상의 코드를 작성하면 오류가 날 가능성이 높다.

- 고민
  - 테스트 관련 코드들의 관리
    - fixture: 테스트를 위해 만들어진 코드
    - 해결책: autofixture?
  - 함수를 분리하다보니 함수가 곳곳에 퍼지게 된다.
    - 왠지 모르겠지만 불안하다.
    - 함수로 분리하기만 하는 게 맞는건가?
    - 전부 분리하는게 가독성을 더 해치고 있는 건 아닌가?
    - 분리된 함수들이 모였을 때 유기적으로 잘 동작하고 있는건가?

- 답변
  - 추상화 수준이 낮다.
    - 구체적인 작은 단위의 함수들로만 분리되거 있고...
  - 높은 응집, 낮은 결합
    - 단일 기능을 가진 함수로 분리함으로써 낮은 결합은 달성했지만, 높은 응집은 달성하지 못했기 때문이다.
