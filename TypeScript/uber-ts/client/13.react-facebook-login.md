# react facebook login

yarn add react-facebook-login

ë¨¼ì € mutationì—ì„œ ì‚¬ìš©í•  graphql ë¶€í„° ì‘ì„±í•œë‹¤.

SocialLoginQueries.ts

```graphql
import { gql } from 'apollo-boost';

export const FACEBOOK_CONNECT = gql`
  mutation facebookConnect(
    $firstName: String!
    $lastName: String!
    $email: String
    $fbId: String!
  ) {
    FacebookConnect(
      firstName: $firstName
      lastName: $lastName
      email: $email
      fbId: $fbId
    ) {
      ok
      error
      token
    }
  }
`;
```

ì‘ì„±ì´ ì™„ë£Œë˜ë©´ yarn codegenìœ¼ë¡œ íƒ€ì…ì„ ë§Œë“ ë‹¤.

## SocialLoginContainer.tsx

```tsx
import React from 'react';
import { useMutation } from '@apollo/react-hooks';
import { RouteComponentProps } from 'react-router-dom';
import { toast } from 'react-toastify';
import SocialLoginPresenter from './SocialLoginPresenter';
import { FACEBOOK_CONNECT } from './SocialLoginQueries';
import { facebookConnect, facebookConnectVariables } from '../../types/api';

type Props = RouteComponentProps;

interface FbResponse {
  email: string;
  id: string;
  first_name: string;
  last_name: string;
  accessToken: string;
}

const SocialLoginContainer: React.FC<Props> = () => {
  const [facebookLoginMutation, { error }] = useMutation<
    facebookConnect,
    facebookConnectVariables
  >(FACEBOOK_CONNECT, {
    update(cache, { data }) {
      if (!error && data) {
        const { FacebookConnect } = data;
        localStorage.setItem('jwt', FacebookConnect.token as string);
        cache.writeData({
          data: {
            auth: {
              __typename: 'Auth',
              isLoggedIn: true,
            },
          },
        });
      }
    },
  });

  const mutation = async (fbData: FbResponse) => {
    const {
      email,
      id: fbId,
      first_name: firstName,
      last_name: lastName,
      accessToken,
    } = fbData;
    if (accessToken) {
      toast.success(`Welcome ${firstName} ğŸ˜Š`);
      await facebookLoginMutation({
        variables: { email, fbId, firstName, lastName },
      });
    } else {
      toast.error(`Login failed ğŸ˜¿`);
    }
  };

  return <SocialLoginPresenter callback={mutation} />;
};

export default SocialLoginContainer;
```

ì½”ë“œë¥¼ ì˜ë¼ë³´ì.

```tsx
const [facebookLoginMutation, { error }] = useMutation<
  facebookConnect,
  facebookConnectVariables
>(FACEBOOK_CONNECT, {
  update(cache, { data }) {
    if (!error && data) {
      const { FacebookConnect } = data;
      localStorage.setItem('jwt', FacebookConnect.token as string);
      cache.writeData({
        data: {
          auth: {
            __typename: 'Auth',
            isLoggedIn: true,
          },
        },
      });
    }
  },
});
```

useMutationì„ ë§Œë“¤ì—ˆë‹¤.

mutationì´ ì„±ê³µí•´ì„œ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ë©´ localStateë¥¼ ì—…ë°ì´íŠ¸ í•œë‹¤.

```tsx
const mutation = async (fbData: FbResponse) => {
  const {
    email,
    id: fbId,
    first_name: firstName,
    last_name: lastName,
    accessToken,
  } = fbData;
  if (accessToken) {
    toast.success(`Welcome ${firstName} ğŸ˜Š`);
    await facebookLoginMutation({
      variables: { email, fbId, firstName, lastName },
    });
  } else {
    toast.error(`Login failed ğŸ˜¿`);
  }
};
```

mutationì„ ì‹¤í–‰í•˜ê¸° ìœ„í•œ í•¨ìˆ˜ë¥¼ ë§Œë“¤ì—ˆë‹¤. ì´ í•¨ìˆ˜ëŠ” callbackìœ¼ë¡œ SocialLoginPresenterì— ì „ë‹¬ ë  ê²ƒì´ë‹¤.

ì¸ìì¸ fbDataëŠ” facebook ë¡œê·¸ì¸ì´ ì‹¤í–‰ëœ í›„ ë°›ì•„ì˜¤ëŠ” ê°’ì´ë‹¤.

accessTokenì´ ìˆë‹¤ë©´ ë¡œê·¸ì¸ì— ì„±ê³µí•œ ê²ƒì´ê³  ë§Œë“¤ì–´ ë‘ì—ˆë˜ mutationì„ ì‹¤í–‰í•œë‹¤.

## SocialLoginPresenter.tsx

```tsx
import React from 'react';
import Helmet from 'react-helmet';
import styled from 'styled-components';
import FacebookLogin, { ReactFacebookLoginInfo } from 'react-facebook-login';
import PropTypes from 'prop-types';
import BackArrow from '../../Components/BackArrow';

const Container = styled.div`
  margin-top: 30px;
  padding: 50px 20px;
`;

const Title = styled.h2`
  font-size: 25px;
  margin-bottom: 40px;
`;

const BackArrowExtended = styled(BackArrow)`
  position: absolute;
  top: 20px;
  left: 20px;
`;

interface FbResponse extends ReactFacebookLoginInfo {
  email: string;
  id: string;
  first_name: string;
  last_name: string;
}

interface Props {
  callback: (fbData: FbResponse) => Promise<void>;
}

const SocialLoginPresenter: React.FC<Props> = ({ callback }) => (
  <Container>
    <Helmet>
      <title>Social Login | Nuber</title>
    </Helmet>
    <Title>Choose an account</Title>
    <BackArrowExtended backTo="/" />
    <FacebookLogin
      appId="appId"
      autoLoad
      fields="name,email,picture,last_name,first_name"
      callback={callback}
    />
  </Container>
);

SocialLoginPresenter.propTypes = {
  callback: PropTypes.func.isRequired,
};

export default SocialLoginPresenter;
```

appIdì— ìì‹ ì˜ appIdë¥¼ ì…ë ¥í•œë‹¤.

react-facebook-loginì´ë¼ëŠ” packageë¥¼ ì‚¬ìš©í–ˆë‹¤.

ì´ packageëŠ” callback í•¨ìˆ˜ì˜ ì¸ìë¡œ `ReactFacebookLoginInfo`ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— interfaceë¥¼ ë§Œë“¤ì–´ ìƒì†ë°›ì•˜ë‹¤.

```tsx
interface FbResponse extends ReactFacebookLoginInfo {
  email: string;
  id: string;
  first_name: string;
  last_name: string;
}
```

```tsx
<FacebookLogin
  appId="appId"
  autoLoad
  fields="name,email,picture,last_name,first_name"
  callback={callback}
/>
```

appIdë¥¼ ì…ë ¥í•œë‹¤. autoLoadëŠ” trueì¼ ê²½ìš° í˜ì´ì§€ì— ì ‘ê·¼í•˜ìë§ˆì ë¡œê·¸ì¸ì„ ì‹œë„í•œë‹¤.
fieldsëŠ” ë°›ì•„ì˜¬ ë°ì´í„°ë‹¤.
callbackì€ SocialLoginPresenterê°€ ì „ë‹¬ë°›ì€ callback í•¨ìˆ˜ë‹¤.
