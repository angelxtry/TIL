# 3장. 문법의 탄생

- 문법이란 프로그래밍 언어 설계자가 만든 이렇게 쓰면 이런 의미로 해석된다라고 정한 규칙이다.
- 프로그래밍 언어가 사람은 편하게 하기 위해 만들어졌다고 했다.
- 문법은 무엇을 편하게 하기 위해 만들어졌을까?

- 문법은 언어 설계자가 정한 규칙이다.

- Python에서는 `=`가 연산자가 아닌 구문이다.
- 식의 중간에 섞어서 사용할 수 없다.

## 스택 머신과 FORTH

- 1958년 경에 개발된 FORTH는 문법이 거의 존재하지 않는 언어다.
- 세상의 모든 언어가 가독성이 있다고 주장하지만, 처음 그 언어를 다루는 사람은 항상 당황한다.
- 이는 난해하고 변덕스러운 문법 때문이다.
- FORTH는 구문을 최대한 제한함으로써 문제를 해결한다.

- 1과 2를 더한다는 코드를 다음과 같이 쓴다.

```cmd
1 2 +
```

- FORTH의 가장 큰 특징은 스택을 사용한다는 것이다.
- 스택은 위가 열린 상자로 표현할 수 있다.
- 1을 스택에 넣고, 2를 스택에 넣고, +를 만나면 2개를 꺼내 더한 결과를 스택에 담는다.

```cmd
1 2 3 * +
```

- 1, 2, 3을 순차적으로 스택에 넣고 *를 만나면 2, 3을 꺼내서 결과를 다시 스택에 넣고 +를 만나면 1과 결과를 꺼내 계산된 결과를 다시 스택에 넣는다.

- FORTH는 괄호도 연산자 우선순위라는 규칙도 도입하지 않았다.

## 현재도 살아있는 스택 머신

- Java, Python, Ruby 등은 스택 머신 형의 VM을 사용하고 있다.
- VM이 실행하는 명령열도 FORTH와 같은 구조로 되어 있다.
- 프로그램은 내부적으로 FORTH와 같은 프로그램으로 컴파일되어 동작한다.

- Python에서는 표준으로 장책되어 있는 dis 라이브러리를 사용해 VM이 실행할 명령열을 출력할 수 있다.

```py
import dis
dis.dis(lambda x, y, z: (x + y) * z)
```

```cmd
  1           0 LOAD_FAST                0 (x)
              2 LOAD_FAST                1 (y)
              4 BINARY_ADD
              6 LOAD_FAST                2 (z)
              8 BINARY_MULTIPLY
             10 RETURN_VALUE
```

- FORTH와 동일하게 `x y + z *`순으로 나열되어 있다.

## 구문 트리와 LISP

- LISP는 하나의 구역을 표현하기 위해 항상 괄호를 사용한다.
- 1과 2를 더한하는 다음과 같이 표현한다.

```lisp
(+ 1 2)
```

- 1과 2를 더한 후 3을 곱한다.

```lisp
(* (+ 1 2) 3)
```

- 이 식을 구문 트리(AST, Abstract Syntax Tree)로 표현할 수 있다.

- Python에 기본으로 장착되어 있는 ast 라이브러리를 사용하면 특정 코드가 어떤 구문트리로 구성되어 있는지 알 수 있다.

```py
import ast
ast.dump(ast.parse("1 + 2"))
ast.dump(ast.parse("(1 + 2) * 3"))
```

----

## tip 1

- 어떤 것을 공부해서 이해했다고 치자.
- 정말 이해한 것이 맞는지를 확인하기 위해서는 결과물이 필요하다.
- 자신이 이해한 것을 정리해서 그것을 제3자에게 검증을 받는 수 밖에 없다.

- 에러 메시지는 우리가 만든 코드를 언어 처리계가 열심히 읽어서 여기를 모르겠어 라고 대답해주고 있는 것이다.
- 언어 처리계외 커뮤니케이션을 하고 싶다면 에러 메시지를 읽고 이해하자.

----

## 중위 표기법

- LIST에서는 1 더하기 2를 (+ 1 2) FORTH에서는 1 2 + 라고 표현한다.
- 수식에서는 1 + 2로 표현한다.
- 이를 각각 전위, 후위, 중위 표기법이라고 한다.
- 사람들은 프로그래밍 언어를 배우기 전부터 중위 표기법에 익숙하다.
- FORTRAN은 이 익숙한 방법을 적용할 수 있도록 만들어졌다.

## 구문 해석기 Parser

- Parser는 소스 코드를 문자열로 읽어 들여 해석하고, 그것을 구문 트리로 만드는 프로그램이다.
- 문법 설계와 구문 분석기 구현은 프로그래밍 언어의 외관을 결정하는 중요한 요소다.
- 언어 설계자는 문법을 설계할 때 무엇을 쉽게 쓸 수 있도록 할 것인지, 어떤 실수를 줄이도록 할 것인지 등 프로그래밍 언어가 사용자에게 어떤 가치를 줄 수 있을지 생각한다.

----

## tip 2

- 어쨌든 전부 다 한 번은 공부해보자는 어리석은 선택이다.
- 우선은 간단한 것도 괜찮으니, 무엇이라도 만들어보자.
- 그 과정에서 나는 이것을 할 수 있어, 이것을 하기 위해서는 공부가 필요해를 알 수 있게 된다.
- 이 과정을 반복해가면 보다 복잡한 것을 만드는 능력이 몸에 베게 된다.

----

- 똑같은 처리도 언어에 따라 표현 방법이 틀리다.
- 그러나 구문 트리로 표현하면 거의 동일하다.
- 언어에 차이가 생긴 것은 어떤 문자열을 쓰면 어떤 구문 트리가 생기는가 라는 규칙이다.
- 이것이 문법이다.
