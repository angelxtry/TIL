# 7. reduce에 대한 질문과 리펙토링

- 동기, 비동기를 다루는 reduce가 재귀없이도 가능한가?

- 일단 기존에 구현한 reduce를 사용해보자.

```js
go(
  reduce((a, b) => a + b, [1, 2, 3, 4, 5]),
  log);
go(
  reduce((a, b) => Promise.resolve(a + b), [1, 2, 3, 4, 5]),
  log);
go(
  reduce((a, b) => Promise.resolve(a + b), [1, 2, 3, 4, 5], 10),
  log);
go(
  reduce((a, b) => Promise.resolve(a + b),
    [1, 2, 3, 4, 5], Promise.resolve(10)),
  log);
```

- 기존에 만들었던 reduce는 다음과 같다.

```js
const reduce = curry(function(f, coll, acc) {
  const iter = collIter(coll);
  acc = acc === undefined ? iter.next().value : acc;
  return then2(acc, function recur(acc) {
    for (const v of iter) {
      acc = f(acc, v);
      if (acc instanceof Promise) return acc.then(recur);
    }
  });
});
```

- 재귀를 이용하지 않아도 reduce를 만들 수 있다.

```js
const reduce = curry(function(f, coll, acc) {
  const iter = collIter(coll);
  acc = acc === undefined ? iter.next().value : acc;
  for (const v of iter) {
    acc = acc instanceof Promise ?
      acc.then(acc => f(acc, v)) : f(acc, v);
  }
  return acc;
})
```

- then1, then2는 go로 대체가 가능하기 때문에 완전히 제거할 수 있다.

- 재귀와 for...of가 필요없어진다면 gen 함수도 필요 없어진다.
- gen 함수를 사용하고 있는 함수들을 수정해보자.
