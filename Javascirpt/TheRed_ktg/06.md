# 프론트엔드 성능

make it work, Make it right, Make it fast.

속도가 빨라지면 사용자 경험이 좋아져요.

비용을 아낄 수 있어요.

면접 문제로 자주 나와요.

## 성능

시간, 리소스

시간 - 초기 구동 시간, 계산 시간, 반응 시간

리소스 - 자원 소모, cpu, memory, network traffic

초기 구동 시간

- 파일 다운로드
- 컨텐츠 렌더링
- 인터렉션 가능

파일 다운로드

- 파일 갯수와 용량은 작게, 도메인은 분산, 적절한 포멧 사용

1 최신 브라우저는 도메인 당 6개의 접속만 동시 처리 HTTP/1.1 기준

- 다운로드 할 파일 갯수가 한 도메인에 6개 이상이면 다운로드 지연
- 별도 도메인과 CDN등으로 분산하는 것도 방법
- 네이버, 구글 등은 이미지, 스크립트 등을 다른 도메인에서 불러온다.
- HTTP2에서는 동시 접속을 고민하지 않아도 된다.
- 크롬 네트워크탭 프로토콜로 확인할 수 있다.

2 이미지는 최신 포멧 사용 webp는 jpeg 파일의 평균 70% 정도 크기

- **레진 코믹스의 webp 블로그 게시글 확인**
- 지원 타입에 따라 이미지 로딩 - 점진적 향상 기법 ex) picture 태그 등

3 화면 크기와 해상도에 따라 적절한 이미지 로딩

- avif 포멧은 jpeg의 50%

4 웹 폰트 최적화

- 구글 폰트
- WOFF2는 WOFF, TTF 등에 비해 30% 용량이 작다. 

5 화면 크기 등에 따라 필요한 스타일 시트만 로딩 (잘 사용하지 않는다.)

6 Link 태그 만으로 접속 시간 절약

### 컨텐츠 렌더링, 인터렉션 시간

같은 컨텐츠라면 용량을 줄이는 것이 우선

js 파일 압출하자.

1 필수 컨텐츠가 아니라면 비동기 로딩을 고려하자.(광고, 댓글, 헤더/푸터 등)

2 이미지/아이프레임/스크립트 등은 필요할 때까지는 읽지 않는 lazy loading 기법을 고려해보자.

현재는 브라우저가 lazy loading을 지원한다.

3 시간이 많이 걸린다면 플레이스 홀더 등으로 대체


## 계산 시간

웹 워커, 느긋한 계산, 메모이제이션 등을 사용한다.

## 반응 시간

가능하면 JS보다는 CSS 애니메이션을 최대한 활용

다음 CSS 속성 위주로 애니메이션 - GPU 가속 적용

- Transform: translate, scale, rotate
- opacity

레이아웃 변경이나 리페인팅을 유발하는 CSS 속성은 비용이 많이 든다.

- 레이아웃: width, height, padding, margin, dispaly 등
- 페인트

setTimeout 보다는 requestAnimationFrame, Web Animations API 등 활용

- requestAnimationFrame: 브라우저가 최적화, 비활성 탭에서는 동작 안함
- Web Animations API: CSS 애니메이션과 같은 애니메이션 앤진 사용

three.js, velocity.js 와 같은 고성은 애니메이션 라이브러리 사용

will-change 속성을 통해 브라우저가 최적화 할 속성 명시

- 남용하면 리소스 낭비. MDN 에서는 최후의 수단으로  생각하라고 권고

DOM 접근과 업데이트는 가능한 적게, 한 번에 몰아서 처리

- 엘리먼트 추가는 Document Fragment 사용

## 리소스 - 메모리 누수

프로그램이 필요하지 않은 메모리를 계속 점유하는 현상

## 리소스 - 네트워크 트래픽

파일 용량을 줄어기나 필요할 때만 불러와서 트래픽 낭비를 줄인다.

1 최소화(minified)한 JS, CSS 파일 사용

2 프레임워크는 한 개 이하만 사용

3 파일 주소의 파라미터는 주의해서 사용, 의도하지 않은 캐시 버스터가 될 수 있다.
